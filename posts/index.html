
<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>All Posts - etund喔喔喔</title>
	<meta name="author" content="etund">

	
	<meta name="description" content="All Posts QQ粘性效果实现详细步骤 QQ粘性效果实现详细步骤 思路 新建自定义UIButton
添加拖动手势
计算圆的变化
计算圆之间矩形并且填充
回弹
爆炸 步骤 先完成空间布局以及手势添加
然后计算圆的变化，计算圆之间的矩形面积
效果微调 先看看完成后的效果图 written &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="etund喔喔喔" type="application/atom+xml">
	
	<link rel="canonical" href="http://etund.github.com/posts/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<link href='http://fonts.googleapis.com/css?family=Nunito:400,300,700' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
  

</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">
	
	<script src="/javascripts/md5.js"></script>
	<script type="text/javascript">
		$(function(){
			// $('.profilepic').append("<img src='http://www.gravatar.com/avatar/" + MD5("a925813235z@qq.com") + "?s=160' alt='Profile Picture' style='width: 160px;' />");
			$('.profilepic').append("<img src='/images/profine/profine.jpeg' alt='Profile Picture' style='width: 160px;' />");
		});
	</script>
	
</div>

<nav id="main-nav"><!-- <ul class="main">
    <li><a href="/">主页 | Blog</a></li>
    <li><a href="/blog/archives">归档目录 | Archives</a></li>
    <li><a href="http://about.me/shashankmehta">关于我 | About</a></li>
    <li><a href="/intruduction">关于我 | About Me</a></li>
    <li><a href="/link">链接 | Links</a></li>
</ul> -->
<!-- <ul class="main">
    <li><a href="/">主页 | Blog</a></li>
    <li><a href="/blog/archives">归档目录 | Archives</a></li>
    <li><a href="http://about.me/shashankmehta">关于我 | About</a></li>
    <li><a href="/intruduction">关于我 | About Me</a></li>
    <li><a href="/link">链接 | Links</a></li>
</ul> -->
<html>
<!-- <head> -->
<!-- <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="/css/buttons.css" />
</head> -->
<!-- <body> -->
<div id="buttonContainer">
    <a href="/" class="button small gray rounded">主页 | Blog</a><br/><br/>
    <a href="/blog/archives" class="button small gray rounded">归档目录 | Archives</a><br/><br/>
    <a href="/intruduction" class="button small gray rounded">关于我 | About</a><br/><br/>
    <a href="/link" class="button small gray rounded">链接 | Links</a><br/><br/>
</div>
<!-- </body> -->
</html>
<style type="text/css">
.button{
    font:15px Calibri, Arial, sans-serif;

    /* A semi-transparent text shadow */
    text-shadow:1px 1px 0 rgba(255,255,255,0.4);
    
    /* Overriding the default underline styling of the links */
    text-decoration:none !important;
    white-space:nowrap;
    
    display:inline-block;
    vertical-align:baseline;
    position:relative;
    cursor:pointer;
    padding:10px 20px;
    
    background-repeat:no-repeat;

    /* The following two rules are fallbacks, in case
       the browser does not support multiple backgrounds. */

    background-position:bottom left;
    background-image:url('/images/button_bg.png');
    
    /* Multiple backgrounds version. The background images
       are defined individually in color classes */
    
    background-position:bottom left, top right, 0 0, 0 0;
    background-clip:border-box;
    
    /* Applying a default border raidus of 8px */
    
    -moz-border-radius:8px;
    -webkit-border-radius:8px;
    border-radius:8px;
    
    /* A 1px highlight inside of the button */
    
    -moz-box-shadow:0 0 1px #fff inset;
    -webkit-box-shadow:0 0 1px #fff inset;
    box-shadow:0 0 1px #fff inset;
    
    /* Animating the background positions with CSS3 */
    /* Currently works only in Safari/Chrome */
    
    -webkit-transition:background-position 1s;
    -moz-transition:background-position 1s;
    transition:background-position 1s;
}

.button:hover{
    
    /* The first rule is a fallback, in case the browser
       does not support multiple backgrounds
    */
    
    background-position:top left;
    background-position:top left, bottom right, 0 0, 0 0;
}

.button:active{
    /* Moving the button 1px to the bottom when clicked */
    bottom:-1px;
}

/* The three buttons sizes */

.button.big     { font-size:30px;}
.button.medium  { font-size:18px;}
.button.small   { font-size:13px;}

/* A more rounded button */

.button.rounded{
    -moz-border-radius:4em;
    -webkit-border-radius:4em;
    border-radius:4em;
}


/* Defining four button colors */


/* BlueButton */

.blue.button{
    color:#0f4b6d !important;
    
    border:1px solid #84acc3 !important;
    
    /* A fallback background color */
    background-color: #48b5f2;
    
    /* Specifying a version with gradients according to */
    
    background-image:   url('/images/button_bg.png'), url('/images/button_bg.png'),
                        -moz-radial-gradient(   center bottom, circle,
                                                rgba(89,208,244,1) 0,rgba(89,208,244,0) 100px),
                        -moz-linear-gradient(#4fbbf7, #3faeeb);

    background-image:   url('/images/button_bg.png'), url('/images/button_bg.png'),
                        -webkit-gradient(   radial, 50% 100%, 0, 50% 100%, 100,
                                            from(rgba(89,208,244,1)), to(rgba(89,208,244,0))),
                        -webkit-gradient(linear, 0% 0%, 0% 100%, from(#4fbbf7), to(#3faeeb));
}

.blue.button:hover{
    background-color:#63c7fe;
    
    background-image:   url('/images/button_bg.png'), url('/images/button_bg.png'),
                        -moz-radial-gradient(   center bottom, circle,
                                                rgba(109,217,250,1) 0,rgba(109,217,250,0) 100px),
                        -moz-linear-gradient(#63c7fe, #58bef7);
                        
    background-image:   url('/images/button_bg.png'), url('/images/button_bg.png'),
                        -webkit-gradient(   radial, 50% 100%, 0, 50% 100%, 100,
                                            from(rgba(109,217,250,1)), to(rgba(109,217,250,0))),
                        -webkit-gradient(linear, 0% 0%, 0% 100%, from(#63c7fe), to(#58bef7));
}

/* Green Button */

.green.button{
    color:#345903 !important;
    border:1px solid #96a37b !important;    
    background-color: #79be1e;
    
    background-image:url('/images/button_bg.png'), url('/images/button_bg.png'), -moz-radial-gradient(center bottom, circle, rgba(162,211,30,1) 0,rgba(162,211,30,0) 100px),-moz-linear-gradient(#82cc27, #74b317);
    background-image:url('/images/button_bg.png'), url('/images/button_bg.png'), -webkit-gradient(radial, 50% 100%, 0, 50% 100%, 100, from(rgba(162,211,30,1)), to(rgba(162,211,30,0))),-webkit-gradient(linear, 0% 0%, 0% 100%, from(#82cc27), to(#74b317));
}

.green.button:hover{
    background-color:#89d228;
    
    background-image:url('/images/button_bg.png'), url('/images/button_bg.png'), -moz-radial-gradient(center bottom, circle, rgba(183,229,45,1) 0,rgba(183,229,45,0) 100px),-moz-linear-gradient(#90de31, #7fc01e);
    background-image:url('/images/button_bg.png'), url('/images/button_bg.png'), -webkit-gradient(radial, 50% 100%, 0, 50% 100%, 100, from(rgba(183,229,45,1)), to(rgba(183,229,45,0))),-webkit-gradient(linear, 0% 0%, 0% 100%, from(#90de31), to(#7fc01e));
}

/* Orange Button */

.orange.button{
    color:#693e0a !important;
    border:1px solid #bea280 !important;    
    background-color: #e38d27;
    
    background-image:url('/images/button_bg.png'), url('/images/button_bg.png'), -moz-radial-gradient(center bottom, circle, rgba(232,189,45,1) 0,rgba(232,189,45,0) 100px),-moz-linear-gradient(#f1982f, #d4821f);
    background-image:url('/images/button_bg.png'), url('/images/button_bg.png'), -webkit-gradient(radial, 50% 100%, 0, 50% 100%, 100, from(rgba(232,189,45,1)), to(rgba(232,189,45,0))),-webkit-gradient(linear, 0% 0%, 0% 100%, from(#f1982f), to(#d4821f));
}

.orange.button:hover{
    background-color:#ec9732;
    
    background-image:url('/images/button_bg.png'), url('/images/button_bg.png'), -moz-radial-gradient(center bottom, circle, rgba(241,192,52,1) 0,rgba(241,192,52,0) 100px),-moz-linear-gradient(#f9a746, #e18f2b);
    background-image:url('/images/button_bg.png'), url('/images/button_bg.png'), -webkit-gradient(radial, 50% 100%, 0, 50% 100%, 100, from(rgba(241,192,52,1)), to(rgba(241,192,52,0))),-webkit-gradient(linear, 0% 0%, 0% 100%, from(#f9a746), to(#e18f2b));
}

.gray.button{
    color:#525252 !important;
    border:1px solid #a5a5a5 !important;    
    background-color: #a9adb1;
    
    background-image:url('/images/button_bg.png'), url('/images/button_bg.png'), -moz-radial-gradient(center bottom, circle, rgba(197,199,202,1) 0,rgba(197,199,202,0) 100px),-moz-linear-gradient(#c5c7ca, #92989c);
    background-image:url('/images/button_bg.png'), url('/images/button_bg.png'), -webkit-gradient(radial, 50% 100%, 0, 50% 100%, 100, from(rgba(197,199,202,1)), to(rgba(197,199,202,0))),-webkit-gradient(linear, 0% 0%, 0% 100%, from(#c5c7ca), to(#92989c));
}

.gray.button:hover{
    background-color:#b6bbc0;
    
    background-image:url('/images/button_bg.png'), url('/images/button_bg.png'), -moz-radial-gradient(center bottom, circle, rgba(202,205,208,1) 0,rgba(202,205,208,0) 100px),-moz-linear-gradient(#d1d3d6, #9fa5a9);
    background-image:url('/images/button_bg.png'), url('/images/button_bg.png'), -webkit-gradient(radial, 50% 100%, 0, 50% 100%, 100, from(rgba(202,205,208,1)), to(rgba(202,205,208,0))),-webkit-gradient(linear, 0% 0%, 0% 100%, from(#d1d3d6), to(#9fa5a9));
}

</style>

<section class="aboutme">
  <p>
    点滴记载,技术,设计,生活
  </p>
</section>
</nav>
<nav id="sub-nav">
	<div class="social">
		
		
			<a class="email" href="mailto:a925813235z@qq.com" title="Email">Email</a>
		
		
		
		
		
			<a class="github" href="https://github.com/etund" title="GitHub">GitHub</a>
		
		
		
		
		
		
		
		
		
		
    	
    	
			<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>
</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner"><div class="all-posts">
  <div class="container">
    <div class="row">
      <div class="list-title col-md-offset-3 col-md-6">
        <h4>All Posts</h4>
      </div>
    </div>
  </div>

  <div class="article-list">
    <div class="container">
      
      
      <div class="row">
        <div class="col-md-offset-3 col-md-6">
          <article>
  <h2><a href="/blog/2015/08/31/qqnian-xing-xiao-guo/">QQ粘性效果实现详细步骤</a></h2>
  
  <p>
    <h2>QQ粘性效果实现详细步骤</h2>




<ul>
<li>思路

<ul>
<li>新建自定义UIButton</li>
<li>添加拖动手势</li>
<li>计算圆的变化</li>
<li>计算圆之间矩形并且填充</li>
<li>回弹</li>
<li>爆炸</li>
</ul>
</li>
<li>步骤

<ul>
<li>先完成空间布局以及手势添加</li>
<li>然后计算圆的变化，计算圆之间的矩形面积</li>
<li>效果微调</li>
</ul>
</li>
</ul>




<h2>先看看完成后的效果图</h2>




<p><img src="/images/blog/QQnianxingxiaoguo/bug_1.gif" alt="效果图" /></p>




  </p>
  <span class="meta">
    written 








  


<time datetime="2015-08-31T23:39:43+08:00" data-updated="true" itemprop="datePublished"></time>
    


  </span>

  
    <a class="full-article-link pull-right" rel="full-article" href="/blog/2015/08/31/qqnian-xing-xiao-guo/">阅读全文</a>
  
</article>

        </div>
      </div>
      
      
      <div class="row">
        <div class="col-md-offset-3 col-md-6">
          <article>
  <h2><a href="/blog/2015/08/25/duo-xian-cheng-%5B%3F%5D/">多线程回顾</a></h2>
  
  <p>
    <h4>简单回顾</h4>




<ul>
<li>iOS中多线程实现有几种方案？

<ul>
<li>首先搞清楚什么是线程，什么是多线程。</li>
<li>Mach是第一个以多线程方式处理任务的系统，因此多线程的底层实现方式是基于Mach的线程的。</li>
<li>开发中很少用Mach级的线程，因为Mach级的的线程没有提供多线程的基本特征线程之间是独立的。</li>
<li>基本实现

<ul>
<li>pthead，纯C，手动管理生命周期</li>
<li>NSThread，OC，面向对象。手动管理内存</li>
<li>GCD，纯C，自动管理生命周期，大中央调度，要理解队列与任务，任务在队列里面去除遵循先进先出的准则。</li>
<li>NSOperation,OC，基于GCD的封装，自动管理生命周期，把操作(NSOperation)放进队列(NSOperationQueue)里面，里面的额操作会异步执行。</li>
</ul>
</li>
</ul>
</li>
</ul>




  </p>
  <span class="meta">
    written 








  


<time datetime="2015-08-25T22:13:01+08:00" data-updated="true" itemprop="datePublished"></time>
    


  </span>

  
    <a class="full-article-link pull-right" rel="full-article" href="/blog/2015/08/25/duo-xian-cheng-%5B%3F%5D/">阅读全文</a>
  
</article>

        </div>
      </div>
      
      
      <div class="row">
        <div class="col-md-offset-3 col-md-6">
          <article>
  <h2><a href="/blog/2015/08/21/yuan-liang-wo-zhe-%5B%3F%5D-sheng-bu-ji-fang-zong-ai-zi-you/">原谅我这一生不羁放纵爱自由</a></h2>
  
  <p>
    

  </p>
  <span class="meta">
    written 








  


<time datetime="2015-08-21T22:13:01+08:00" data-updated="true" itemprop="datePublished"></time>
    


  </span>

  
</article>

        </div>
      </div>
      
      
      <div class="row">
        <div class="col-md-offset-3 col-md-6">
          <article>
  <h2><a href="/blog/2015/07/08/iosduo-xian-cheng-er/">iOS多线程(二)</a></h2>
  
  <p>
    <h2>iOS多线程(二)</h2>




<h3>NSOperation</h3>




<ul>
<li>NSOperation是对GCD的封装，既然封装了，那么就没有GCD那么好玩，但是同时也更加便捷的实现以下常用的功能。

<ul>
<li>创建：NSOperation是一个抽象类，不能实例化，但可以通过他的子类来使用，子类分别是NSBlockOperation和NSInvocationOperation，创建方式如下。</li>
</ul>
</li>
</ul>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">//NSBlockOperation</span>
</span><span class='line'>  <span class="bp">NSBlockOperation</span> <span class="o">*</span><span class="n">opeaBlock</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSBlockOperation</span> <span class="nl">blockOperationWithBlock</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
</span><span class='line'>      <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;----1---%@-&quot;</span><span class="p">,[</span><span class="bp">NSThread</span> <span class="n">currentThread</span><span class="p">])</span> <span class="p">;</span>
</span><span class='line'>  <span class="p">}];</span>
</span><span class='line'>  <span class="p">[</span><span class="n">opeaBlock</span> <span class="n">start</span><span class="p">];</span>
</span><span class='line'>  <span class="err">或者</span>
</span><span class='line'><span class="c1">//    NSInvocationOperation</span>
</span><span class='line'>  <span class="bp">NSInvocationOperation</span> <span class="o">*</span><span class="n">invoOpera</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">NSInvocationOperation</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithTarget</span><span class="p">:</span><span class="nb">self</span> <span class="nl">selector</span><span class="p">:</span><span class="k">@selector</span><span class="p">(</span><span class="n">run</span><span class="p">)</span> <span class="nl">object</span><span class="p">:</span><span class="s">@&quot;etund&quot;</span><span class="p">];</span>
</span><span class='line'>  <span class="p">[</span><span class="n">invoOpera</span> <span class="n">start</span><span class="p">];</span>
</span><span class='line'>  <span class="cm">/*运行结果</span>
</span><span class='line'><span class="cm">   2015-07-09 14:00:18.610 Pthread-多平台[91622:193993] ----1---&lt;NSThread: 0x7fc26ae193c0&gt;{number = 1, name = main}---- etund</span>
</span><span class='line'><span class="cm">   */</span>
</span></code></pre></td></tr></table></div></figure>




<ul>
<li>此外，还可以通过自定义类继承NSOperation来使用NSOperation，注意在继承NSOperation的实现中把你想要执行的代码块放进- (void)main;里面就行。</li>
</ul>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">ETOperation</span><span class="p">.</span><span class="n">m</span>
</span><span class='line'><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">main</span><span class="p">{</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;-----1-%@&quot;</span><span class="p">,[</span><span class="bp">NSThread</span> <span class="n">currentThread</span><span class="p">]);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="c1">//调用</span>
</span><span class='line'><span class="c1">//      自定义NSOperation</span>
</span><span class='line'>    <span class="n">ETOpearation</span> <span class="o">*</span><span class="n">operation</span> <span class="o">=</span> <span class="p">[[</span><span class="n">ETOpearation</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">operation</span> <span class="n">start</span><span class="p">];</span>
</span><span class='line'>    <span class="cm">/*运行结果</span>
</span><span class='line'><span class="cm">     2015-07-09 14:00:18.610 Pthread-多平台[91622:193993] ----1---&lt;NSThread: 0x7fc26ae193c0&gt;{number = 1, name = main}---- etund</span>
</span><span class='line'><span class="cm">     */</span>
</span></code></pre></td></tr></table></div></figure>




<ul>
<li>以上线程都没有开启子线程，我们可以用NSOperationQueue与NSOperation结合使用来实现多线程操作，具体做法是把NSOperation实例加到NSOperationQueue队列中，当我们把实例加入队列中的时候，就不用主动调用start方法来开启线程了，线程会自动开启。</li>
</ul>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">//    NSOperationQueue</span>
</span><span class='line'><span class="bp">NSOperationQueue</span> <span class="o">*</span><span class="n">queue</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">NSOperationQueue</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'><span class="c1">//    自定义NSOperation实例</span>
</span><span class='line'><span class="n">ETOpearation</span> <span class="o">*</span><span class="n">operation</span> <span class="o">=</span>  <span class="p">[[</span><span class="n">ETOpearation</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'><span class="bp">NSBlockOperation</span> <span class="o">*</span><span class="n">opeaBlock</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSBlockOperation</span> <span class="nl">blockOperationWithBlock</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;----1---%@-&quot;</span><span class="p">,[</span><span class="bp">NSThread</span> <span class="n">currentThread</span><span class="p">])</span> <span class="p">;</span>
</span><span class='line'><span class="p">}];</span>
</span><span class='line'><span class="bp">NSInvocationOperation</span> <span class="o">*</span><span class="n">invoOpera</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">NSInvocationOperation</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithTarget</span><span class="p">:</span><span class="nb">self</span> <span class="nl">selector</span><span class="p">:</span><span class="k">@selector</span><span class="p">(</span><span class="nl">run</span><span class="p">:)</span> <span class="nl">object</span><span class="p">:</span><span class="s">@&quot;etund&quot;</span><span class="p">];</span>
</span><span class='line'><span class="p">[</span><span class="n">queue</span> <span class="nl">addOperation</span><span class="p">:</span><span class="n">opeaBlock</span><span class="p">];</span>
</span><span class='line'><span class="p">[</span><span class="n">queue</span> <span class="nl">addOperation</span><span class="p">:</span><span class="n">invoOpera</span><span class="p">];</span>
</span><span class='line'><span class="p">[</span><span class="n">queue</span> <span class="nl">addOperation</span><span class="p">:</span><span class="n">operation</span><span class="p">];</span>
</span><span class='line'><span class="cm">/*运行结果</span>
</span><span class='line'><span class="cm"> 2015-07-09 14:24:26.191 Pthread-多平台[98921:212686] -----1-&lt;NSThread: 0x7ff1eab20440&gt;{number = 5, name = (null)}</span>
</span><span class='line'><span class="cm"> 2015-07-09 14:24:26.191 Pthread-多平台[98921:212687] ----1---&lt;NSThread: 0x7ff1eab20190&gt;{number = 4, name = (null)}-</span>
</span><span class='line'><span class="cm"> 2015-07-09 14:24:26.191 Pthread-多平台[98921:212689] ----1---&lt;NSThread: 0x7ff1eaa37910&gt;{number = 3, name = (null)}---- etund</span>
</span><span class='line'><span class="cm"> */</span>
</span></code></pre></td></tr></table></div></figure>




<p>&mdash;&mdash;&ndash;注意看上面运行结果，已经创建了多个线程了，至此我们成功的利用NSOperationQueue以及NSOperation实现多线程操作。</p>




<ul>
<li>我们也可以直接在队列里面添加线程代码块，就可以省去新建NSOperation实例</li>
</ul>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">//    NSOperationQueue</span>
</span><span class='line'>    <span class="bp">NSOperationQueue</span> <span class="o">*</span><span class="n">queue</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">NSOperationQueue</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">queue</span> <span class="nl">addOperationWithBlock</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;=======1==%@&quot;</span><span class="p">,[</span><span class="bp">NSThread</span> <span class="n">currentThread</span><span class="p">]);</span>
</span><span class='line'>    <span class="p">}];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">queue</span> <span class="nl">addOperationWithBlock</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;=======2==%@&quot;</span><span class="p">,[</span><span class="bp">NSThread</span> <span class="n">currentThread</span><span class="p">]);</span>
</span><span class='line'>    <span class="p">}];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">queue</span> <span class="nl">addOperationWithBlock</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;=======3==%@&quot;</span><span class="p">,[</span><span class="bp">NSThread</span> <span class="n">currentThread</span><span class="p">]);</span>
</span><span class='line'>    <span class="p">}];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">queue</span> <span class="nl">addOperationWithBlock</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;=======4==%@&quot;</span><span class="p">,[</span><span class="bp">NSThread</span> <span class="n">currentThread</span><span class="p">]);</span>
</span><span class='line'>    <span class="p">}];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">queue</span> <span class="nl">addOperationWithBlock</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;=======5==%@&quot;</span><span class="p">,[</span><span class="bp">NSThread</span> <span class="n">currentThread</span><span class="p">]);</span>
</span><span class='line'>    <span class="p">}];</span>
</span><span class='line'>    <span class="cm">/*运行结果</span>
</span><span class='line'><span class="cm">     2015-07-09 14:20:30.289 Pthread-多平台[97728:209415] =======3==&lt;NSThread: 0x7ffdf2b90220&gt;{number = 7, name = (null)}</span>
</span><span class='line'><span class="cm">     2015-07-09 14:20:30.289 Pthread-多平台[97728:209432] =======1==&lt;NSThread: 0x7ffdf2b8fdc0&gt;{number = 4, name = (null)}</span>
</span><span class='line'><span class="cm">     2015-07-09 14:20:30.289 Pthread-多平台[97728:209416] =======5==&lt;NSThread: 0x7ffdf0e015a0&gt;{number = 5, name = (null)}</span>
</span><span class='line'><span class="cm">     2015-07-09 14:20:30.289 Pthread-多平台[97728:209414] =======2==&lt;NSThread: 0x7ffdf0c313e0&gt;{number = 3, name = (null)}</span>
</span><span class='line'><span class="cm">     2015-07-09 14:20:30.289 Pthread-多平台[97728:209417] =======4==&lt;NSThread: 0x7ffdf0c314c0&gt;{number = 6, name = (null)}</span>
</span><span class='line'><span class="cm">     */</span>
</span></code></pre></td></tr></table></div></figure>




<p><code>注意：我们可以通过maxConcurrentOperationCount来设置改队列可以开启的最大线程数，最小是1，当设置为0的时候，不执行队列中的任务，当为1的时候为GCD中的串行同步(并行同步，主队列异步，全局队列同步)一样效果。</code>
&mdash;&mdash;&mdash;&mdash;-至此NSOperation的基本用法差不多涉及了，下面在来看看NSOperation封装带来的好处
- 队列挂起，suspended这个属性可以控制当前线程队列的暂停和开启，在这里，已经默认你是对iOS多线程的任务有一定了解的，suspended为NO时，回执行完当前的NSOperation实例的任务，后面的任务不会在执行知道你开启</p>




<ul>
<li>队列挂起或开启如下。</li>
</ul>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">touchesBegan:</span><span class="p">(</span><span class="bp">NSSet</span> <span class="o">*</span><span class="p">)</span><span class="nv">touches</span> <span class="nf">withEvent:</span><span class="p">(</span><span class="bp">UIEvent</span> <span class="o">*</span><span class="p">)</span><span class="nv">event</span><span class="p">{</span>
</span><span class='line'><span class="c1">//    NSOperationQueue</span>
</span><span class='line'><span class="c1">//    挂起</span>
</span><span class='line'>    <span class="bp">NSOperationQueue</span> <span class="o">*</span><span class="n">queue</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">NSOperationQueue</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'>    <span class="nb">self</span><span class="p">.</span><span class="n">queue</span> <span class="o">=</span> <span class="n">queue</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">[</span><span class="n">queue</span> <span class="nl">addOperationWithBlock</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5000</span><span class="p">;</span> <span class="n">i</span> <span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;0--%d-----%@---&quot;</span><span class="p">,</span><span class="n">i</span><span class="p">,[</span><span class="bp">NSThread</span> <span class="n">currentThread</span><span class="p">]);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}];</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">[</span><span class="n">queue</span> <span class="nl">addOperationWithBlock</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5000</span><span class="p">;</span> <span class="n">i</span> <span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;1--%d-----%@---&quot;</span><span class="p">,</span><span class="n">i</span><span class="p">,[</span><span class="bp">NSThread</span> <span class="n">currentThread</span><span class="p">]);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">queue</span> <span class="nl">addOperationWithBlock</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5000</span><span class="p">;</span> <span class="n">i</span> <span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;2--%d-----%@---&quot;</span><span class="p">,</span><span class="n">i</span><span class="p">,[</span><span class="bp">NSThread</span> <span class="n">currentThread</span><span class="p">]);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}];</span>
</span><span class='line'>
</span><span class='line'> <span class="c1">//当执行一个任务的时候收到suspended为NO，就会执行完当前循环，停在当前任务。</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="c1">//完成一个点击事件就会改变suspended的状态</span>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">touchesEnded:</span><span class="p">(</span><span class="bp">NSSet</span> <span class="o">*</span><span class="p">)</span><span class="nv">touches</span> <span class="nf">withEvent:</span><span class="p">(</span><span class="bp">UIEvent</span> <span class="o">*</span><span class="p">)</span><span class="nv">event</span><span class="p">{</span>
</span><span class='line'>    <span class="nb">self</span><span class="p">.</span><span class="n">queue</span><span class="p">.</span><span class="n">suspended</span> <span class="o">=</span> <span class="o">!</span><span class="nb">self</span><span class="p">.</span><span class="n">queue</span><span class="p">.</span><span class="n">isSuspended</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<ul>
<li>队列取消，把当前队列后面的NSOperation实例全部清除掉，相对于挂起，取消是不可逆的。
所以在系统自定义的NSOperation实例中，取消跟挂起取YES结果一样</li>
</ul>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">touchesBegan:</span><span class="p">(</span><span class="bp">NSSet</span> <span class="o">*</span><span class="p">)</span><span class="nv">touches</span> <span class="nf">withEvent:</span><span class="p">(</span><span class="bp">UIEvent</span> <span class="o">*</span><span class="p">)</span><span class="nv">event</span><span class="p">{</span>
</span><span class='line'>    <span class="bp">NSOperationQueue</span> <span class="o">*</span><span class="n">queue</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">NSOperationQueue</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">queue</span> <span class="nl">addOperationWithBlock</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5000</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
</span><span class='line'>            <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;----1---%@---%d-&quot;</span><span class="p">,[</span><span class="bp">NSThread</span> <span class="n">currentThread</span><span class="p">],</span><span class="n">i</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}];</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">[</span><span class="n">queue</span> <span class="nl">addOperationWithBlock</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5000</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
</span><span class='line'>            <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;----2---%@--%d--&quot;</span><span class="p">,[</span><span class="bp">NSThread</span> <span class="n">currentThread</span><span class="p">],</span><span class="n">i</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}];</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">[</span><span class="n">queue</span> <span class="nl">addOperationWithBlock</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5000</span><span class="p">;</span><span class="n">i</span><span class="o">++</span><span class="p">){</span>
</span><span class='line'>            <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;----3---%@--%d--&quot;</span><span class="p">,[</span><span class="bp">NSThread</span> <span class="n">currentThread</span><span class="p">],</span><span class="n">i</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}];</span>
</span><span class='line'>
</span><span class='line'>    <span class="nb">self</span><span class="p">.</span><span class="n">queue</span> <span class="o">=</span> <span class="n">queue</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">touchesEnded:</span><span class="p">(</span><span class="bp">NSSet</span> <span class="o">*</span><span class="p">)</span><span class="nv">touches</span> <span class="nf">withEvent:</span><span class="p">(</span><span class="bp">UIEvent</span> <span class="o">*</span><span class="p">)</span><span class="nv">event</span><span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">queue</span> <span class="n">cancelAllOperations</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<ul>
<li>在自定义的NSOperation类中，当然可以把他看做一个普通的NSOperation实例对象，但是系统给NSOperation提供一个cancel属性，所以他的可控粒度更小，控制起来比较个性，要做到这一点，要在我们自定义类里面重写的main方法里面做功夫</li>
</ul>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">ETOperation</span><span class="p">.</span><span class="n">m</span>
</span><span class='line'><span class="c1">//这样就可以做到在任务里想停就马上停。</span>
</span><span class='line'><span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5000</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="n">isCancelled</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;%d---1-------%@&quot;</span><span class="p">,</span><span class="n">i</span><span class="p">,[</span><span class="bp">NSThread</span> <span class="n">currentThread</span><span class="p">]);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="err">调用</span>
</span><span class='line'><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nl">touchesBegan</span><span class="p">:(</span><span class="bp">NSSet</span> <span class="o">*</span><span class="p">)</span><span class="n">touches</span> <span class="nl">withEvent</span><span class="p">:(</span><span class="bp">UIEvent</span> <span class="o">*</span><span class="p">)</span><span class="n">event</span><span class="p">{</span>
</span><span class='line'>    <span class="bp">NSOperationQueue</span> <span class="o">*</span><span class="n">queue</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">NSOperationQueue</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">queue</span> <span class="nl">addOperation</span><span class="p">:[[</span><span class="n">ETOpearation</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">]];</span>
</span><span class='line'>    <span class="nb">self</span><span class="p">.</span><span class="n">queue</span> <span class="o">=</span> <span class="n">queue</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nl">touchesEnded</span><span class="p">:(</span><span class="bp">NSSet</span> <span class="o">*</span><span class="p">)</span><span class="n">touches</span> <span class="nl">withEvent</span><span class="p">:(</span><span class="bp">UIEvent</span> <span class="o">*</span><span class="p">)</span><span class="n">event</span><span class="p">{</span>
</span><span class='line'>    <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">queue</span> <span class="n">cancelAllOperations</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<ul>
<li>操作依赖，NSOperation的作用在一定程度上类似于GCD的栅栏队列(Barrier)和队列组，也就是后续步骤要在前面步骤的基础上才能执行。</li>
</ul>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">touchesBegan:</span><span class="p">(</span><span class="bp">NSSet</span> <span class="o">*</span><span class="p">)</span><span class="nv">touches</span> <span class="nf">withEvent:</span><span class="p">(</span><span class="bp">UIEvent</span> <span class="o">*</span><span class="p">)</span><span class="nv">event</span><span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="bp">NSOperationQueue</span> <span class="o">*</span><span class="n">queue</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">NSOperationQueue</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'>    <span class="k">__block</span> <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
</span><span class='line'>    <span class="k">__block</span> <span class="kt">int</span> <span class="n">j</span><span class="p">;</span>
</span><span class='line'>    <span class="bp">NSBlockOperation</span> <span class="o">*</span><span class="n">blockOperation</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSBlockOperation</span> <span class="nl">blockOperationWithBlock</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="n">i</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</span><span class='line'>        <span class="n">j</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}];</span>
</span><span class='line'>
</span><span class='line'>    <span class="bp">NSBlockOperation</span> <span class="o">*</span><span class="n">blockOperation_0</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSBlockOperation</span> <span class="nl">blockOperationWithBlock</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;%d&quot;</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="n">i</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}];</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">[</span><span class="n">blockOperation_0</span> <span class="nl">addDependency</span><span class="p">:</span><span class="n">blockOperation</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">queue</span> <span class="nl">addOperation</span><span class="p">:</span><span class="n">blockOperation</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">queue</span> <span class="nl">addOperation</span><span class="p">:</span><span class="n">blockOperation_0</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<ul>
<li>上述代码没有什么实际意义，拿上面的一个需求吧，例如，下载图片，合成图片。</li>
</ul>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="bp">NSOperationQueue</span> <span class="o">*</span><span class="n">queue</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">NSOperationQueue</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'>    <span class="k">__block</span> <span class="bp">UIImage</span> <span class="o">*</span> <span class="n">image1</span><span class="p">;</span>
</span><span class='line'>    <span class="k">__block</span> <span class="bp">UIImage</span> <span class="o">*</span> <span class="n">image2</span><span class="p">;</span>
</span><span class='line'>    <span class="bp">NSBlockOperation</span> <span class="o">*</span><span class="n">blockOperation</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSBlockOperation</span> <span class="nl">blockOperationWithBlock</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="n">image1</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIImage</span> <span class="nl">imageWithData</span><span class="p">:[</span><span class="bp">NSData</span> <span class="nl">dataWithContentsOfURL</span><span class="p">:[</span><span class="bp">NSURL</span> <span class="nl">URLWithString</span><span class="p">:</span><span class="s">@&quot;http://f.hiphotos.baidu.com/image/pic/item/d788d43f8794a4c2e882eb8b0df41bd5ac6e39e8.jpg&quot;</span><span class="p">]]];</span>
</span><span class='line'>        <span class="n">image2</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIImage</span> <span class="nl">imageWithData</span><span class="p">:[</span><span class="bp">NSData</span> <span class="nl">dataWithContentsOfURL</span><span class="p">:[</span><span class="bp">NSURL</span> <span class="nl">URLWithString</span><span class="p">:</span><span class="s">@&quot;http://h.hiphotos.baidu.com/image/pic/item/ac6eddc451da81cbd668501c5666d01608243151.jpg&quot;</span><span class="p">]]];</span>
</span><span class='line'>    <span class="p">}];</span>
</span><span class='line'>
</span><span class='line'>    <span class="bp">NSBlockOperation</span> <span class="o">*</span><span class="n">blockOperation_0</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSBlockOperation</span> <span class="nl">blockOperationWithBlock</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="n">UIGraphicsBeginImageContextWithOptions</span><span class="p">(</span><span class="n">CGSizeMake</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span> <span class="nb">NO</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>        <span class="p">[</span><span class="n">image1</span> <span class="nl">drawAsPatternInRect</span><span class="p">:</span><span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">)];</span>
</span><span class='line'>        <span class="p">[</span><span class="n">image2</span> <span class="nl">drawAsPatternInRect</span><span class="p">:</span><span class="n">CGRectMake</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">)];</span>
</span><span class='line'>        <span class="bp">UIImage</span> <span class="o">*</span><span class="n">image</span> <span class="o">=</span> <span class="n">UIGraphicsGetImageFromCurrentImageContext</span><span class="p">();</span>
</span><span class='line'>        <span class="n">UIGraphicsEndImageContext</span><span class="p">();</span>
</span><span class='line'>        <span class="p">[[</span><span class="bp">NSOperationQueue</span> <span class="n">mainQueue</span><span class="p">]</span> <span class="nl">addOperationWithBlock</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
</span><span class='line'>            <span class="nb">self</span><span class="p">.</span><span class="n">myView</span><span class="p">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}];</span>
</span><span class='line'>    <span class="p">}];</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">[</span><span class="n">blockOperation_0</span> <span class="nl">addDependency</span><span class="p">:</span><span class="n">blockOperation</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">queue</span> <span class="nl">addOperation</span><span class="p">:</span><span class="n">blockOperation</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">queue</span> <span class="nl">addOperation</span><span class="p">:</span><span class="n">blockOperation_0</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>




<ul>
<li>操作监听，在NSOperation属性中，有一个属性@property (copy) void (^completionBlock)(void)可以在某个操作执行完成时，在执行一段代码，有很多需求也用到这个属性，例如图片的下载，如上，可以试着把上面的那段代码改写，这里就随便写一段简单的代码来展示操作监听的强大。</li>
</ul>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">touchesBegan:</span><span class="p">(</span><span class="bp">NSSet</span> <span class="o">*</span><span class="p">)</span><span class="nv">touches</span> <span class="nf">withEvent:</span><span class="p">(</span><span class="bp">UIEvent</span> <span class="o">*</span><span class="p">)</span><span class="nv">event</span><span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="bp">NSOperationQueue</span> <span class="o">*</span><span class="n">queue</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">NSOperationQueue</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'>    <span class="k">__block</span> <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
</span><span class='line'>    <span class="k">__block</span> <span class="kt">int</span> <span class="n">j</span><span class="p">;</span>
</span><span class='line'>    <span class="bp">NSBlockOperation</span> <span class="o">*</span><span class="n">blockOperation</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSBlockOperation</span> <span class="nl">blockOperationWithBlock</span><span class="p">:</span><span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="n">i</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</span><span class='line'>        <span class="n">j</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}];</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">blockOperation</span><span class="p">.</span><span class="n">completionBlock</span> <span class="o">=</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;%d&quot;</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="n">i</span><span class="p">);</span>
</span><span class='line'>    <span class="p">};</span>
</span><span class='line'>    <span class="p">[</span><span class="n">queue</span> <span class="nl">addOperation</span><span class="p">:</span><span class="n">blockOperation</span><span class="p">];</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<h3>线程通信</h3>




<ul>
<li> 线程之间的通信，线程的通信，在一个进程中，线程往往不是鼓励存在的，多个线程之间需要经常进行通信</li>
<li><p> 线程间通信的体现</p>

<ul>
<li> 在一个线程传递数据给另外一个线程</li>
<li> 在一个线程中执行完成任务后，转到另一个线程继续执行任务</li>
</ul>
</li>
<li><p>NSThread的线程通信</p></li>
</ul>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">//这个方法是指在当前线程运行完后调到主线程里面运行</span>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">performSelectorOnMainThread:</span><span class="p">(</span><span class="kt">SEL</span><span class="p">)</span><span class="nv">aSelector</span> <span class="nf">withObject:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">arg</span> <span class="nf">waitUntilDone:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">wait</span><span class="p">;</span>
</span><span class='line'><span class="c1">//这个方法是指在当前线程运行完后调用另外一个线程里面运行</span>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">performSelector:</span><span class="p">(</span><span class="kt">SEL</span><span class="p">)</span><span class="nv">aSelector</span> <span class="nf">onThread:</span><span class="p">(</span><span class="bp">NSThread</span> <span class="o">*</span><span class="p">)</span><span class="nv">thr</span> <span class="nf">withObject:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">arg</span> <span class="nf">waitUntilDone:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">wait</span>
</span><span class='line'><span class="err">```</span>
</span><span class='line'><span class="o">-</span> <span class="n">GCD</span><span class="err">的线程通信</span><span class="p">,</span><span class="n">GCD</span><span class="err">的线程通信十分简单，只是在代码块里面调用代码块，直接上代码吧。</span>
</span></code></pre></td></tr></table></div></figure>




<p>objc
从子线程回到主线程
dispatch_async(
dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^{
    // 执行耗时的异步操作&hellip;
      dispatch_async(dispatch_get_main_queue(), ^{
        // 回到主线程，执行UI刷新操作
        });
});</p>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="p">-</span> <span class="nf">NSOperation</span><span class="err">的线程通信</span>
</span></code></pre></td></tr></table></div></figure>




<p>objc
//回到主线程
[[NSOperationQueue mainQueue] addOperationWithBlock:^{</p>




<pre><code>    }];
</code></pre>




<p>//去子线程
NSOperationQueue *queue = [[NSOperationQueue alloc] init];
    [queue addOperationWithBlock:^{</p>




<pre><code>}];
</code></pre>




<p>```</p>


  </p>
  <span class="meta">
    written 








  


<time datetime="2015-07-08T20:33:34+08:00" data-updated="true" itemprop="datePublished"></time>
    


  </span>

  
</article>

        </div>
      </div>
      
      
      <div class="row">
        <div class="col-md-offset-3 col-md-6">
          <article>
  <h2><a href="/blog/2015/07/08/iosduo-xian-cheng-%5B%3F%5D/">iOS多线程(一)</a></h2>
  
  <p>
    <h2>iOS多线程(一)</h2>




<h3>基本</h3>




<ul>
<li>实现方案：pthread - NSThread  - GCD  - NSOperation</li>
<li>Pthread

<ul>
<li>多平台，可移植</li>
<li>c语言，要程序员管理生命周期</li>
<li>创建</li>
</ul>
</li>
</ul>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">//这里已经开启了多线程，直接在这里调用子线程想要调用的代码</span>
</span><span class='line'><span class="kt">void</span> <span class="o">*</span> <span class="nf">run</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">pramga</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'><span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;-------&quot;</span><span class="p">);</span>
</span><span class='line'><span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">IBAction</span><span class="p">)</span><span class="nf">btnClick:</span><span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nv">sender</span> <span class="p">{</span>
</span><span class='line'><span class="kt">pthread_t</span> <span class="n">pthread</span><span class="p">;</span>
</span><span class='line'><span class="n">pthread_create</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pthread</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">run</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<ul>
<li>NSThread

<ul>
<li>面向对象，简单实用</li>
<li>创建</li>
</ul>
</li>
</ul>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'>    <span class="c1">//隐式创建并启动线程</span>
</span><span class='line'><span class="p">[</span><span class="bp">NSThread</span> <span class="nl">detachNewThreadSelector</span><span class="p">:</span><span class="k">@selector</span><span class="p">(</span><span class="nl">threadRun</span><span class="p">:)</span> <span class="nl">toTarget</span><span class="p">:</span><span class="nb">self</span> <span class="nl">withObject</span><span class="p">:</span><span class="s">@&quot;etund&quot;</span><span class="p">];</span>
</span><span class='line'><span class="err">或者</span>
</span><span class='line'><span class="c1">//创建线程并且启动线程</span>
</span><span class='line'><span class="p">[</span><span class="nb">self</span> <span class="nl">performSelectorInBackground</span><span class="p">:</span><span class="k">@selector</span><span class="p">(</span><span class="nl">threadRun</span><span class="p">:)</span> <span class="nl">withObject</span><span class="p">:</span><span class="s">@&quot;etund&quot;</span><span class="p">];</span>
</span><span class='line'><span class="err">或者</span>
</span><span class='line'><span class="err">上述两个优点是可以快速的创建并启动线程，方便快捷，但是不能对线程进行多余属性的设置，而下面一种方法就可以对线程实例属性的设置，但是要记得要手动开启线程。</span>
</span><span class='line'>   <span class="bp">NSThread</span> <span class="o">*</span><span class="kr">thread</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">NSThread</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithTarget</span><span class="p">:</span><span class="nb">self</span> <span class="nl">selector</span><span class="p">:</span><span class="k">@selector</span><span class="p">(</span><span class="nl">threadRun</span><span class="p">:)</span> <span class="nl">object</span><span class="p">:</span><span class="s">@&quot;etund&quot;</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="kr">thread</span> <span class="n">start</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>




<h3>GCD</h3>




<ul>
<li>听说全称是叫“牛逼的中枢调度器”，但是我还是喜欢叫大中央调度</li>
<li>纯C语言，有很多强大的函数</li>
<li>优势：(纯属板书)

<ul>
<li>GCD是苹果公司为多核的并行运算提出的解决方案</li>
<li>GCD会自动利用更多的CPU内核（比如双核、四核）</li>
<li>GCD会自动管理线程的生命周期（创建线程、调度任务、销毁线程）</li>
<li>程序员只需要告诉GCD想要执行什么任务，不需要编写任何线程管理代码</li>
</ul>
</li>
<li>核心：清楚什么是任务，队列

<ul>
<li>串行与并行不能决定是否要开启新县城</li>
<li>并行表明具有创建新线程的能力，但不一定创建新线程</li>
</ul>
</li>
<li>常用GCD内容

<ul>
<li>串行同步（并行同步/全局队列同步）,由于串行同步，并行同步，以及全局队列同步都是不创建线程按顺序执行，所以归为一类来讲。（不开任何子线程，在主线程中执行）</li>
</ul>
</li>
</ul>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'> <span class="c1">//串行</span>
</span><span class='line'><span class="kt">dispatch_queue_t</span> <span class="n">queue</span> <span class="o">=</span> <span class="n">dispatch_queue_create</span><span class="p">(</span><span class="s">&quot;etund&quot;</span><span class="p">,</span> <span class="n">DISPATCH_QUEUE_SERIAL</span><span class="p">);</span>
</span><span class='line'><span class="c1">//并行</span>
</span><span class='line'><span class="c1">//dispatch_queue_t queue = dispatch_queue_create(&quot;etund&quot;, DISPATCH_QUEUE_CONCURRENT);</span>
</span><span class='line'><span class="n">dispatch_sync</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;%@---1&quot;</span><span class="p">,[</span><span class="bp">NSThread</span> <span class="n">currentThread</span><span class="p">]);</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'><span class="n">dispatch_sync</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;%@----2&quot;</span><span class="p">,[</span><span class="bp">NSThread</span> <span class="n">currentThread</span><span class="p">]);</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'><span class="n">dispatch_sync</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;%@----3&quot;</span><span class="p">,[</span><span class="bp">NSThread</span> <span class="n">currentThread</span><span class="p">]);</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'><span class="err">运行结果</span>
</span><span class='line'> <span class="mi">2015</span><span class="o">-</span><span class="mo">07</span><span class="o">-</span><span class="mi">08</span> <span class="mi">19</span><span class="o">:</span><span class="mi">09</span><span class="o">:</span><span class="mf">39.611</span> <span class="n">Pthread</span><span class="o">-</span><span class="err">多平台</span><span class="p">[</span><span class="mi">63090</span><span class="o">:</span><span class="mi">302902</span><span class="p">]</span> <span class="o">&lt;</span><span class="nl">NSThread</span><span class="p">:</span> <span class="mh">0x7fc79142c1d0</span><span class="o">&gt;</span><span class="p">{</span><span class="n">number</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">main</span><span class="p">}</span><span class="o">---</span><span class="mi">1</span>
</span><span class='line'> <span class="mi">2015</span><span class="o">-</span><span class="mo">07</span><span class="o">-</span><span class="mi">08</span> <span class="mi">19</span><span class="o">:</span><span class="mi">09</span><span class="o">:</span><span class="mf">39.612</span> <span class="n">Pthread</span><span class="o">-</span><span class="err">多平台</span><span class="p">[</span><span class="mi">63090</span><span class="o">:</span><span class="mi">302902</span><span class="p">]</span> <span class="o">&lt;</span><span class="nl">NSThread</span><span class="p">:</span> <span class="mh">0x7fc79142c1d0</span><span class="o">&gt;</span><span class="p">{</span><span class="n">number</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">main</span><span class="p">}</span><span class="o">----</span><span class="mi">2</span>
</span><span class='line'> <span class="mi">2015</span><span class="o">-</span><span class="mo">07</span><span class="o">-</span><span class="mi">08</span> <span class="mi">19</span><span class="o">:</span><span class="mi">09</span><span class="o">:</span><span class="mf">39.612</span> <span class="n">Pthread</span><span class="o">-</span><span class="err">多平台</span><span class="p">[</span><span class="mi">63090</span><span class="o">:</span><span class="mi">302902</span><span class="p">]</span> <span class="o">&lt;</span><span class="nl">NSThread</span><span class="p">:</span> <span class="mh">0x7fc79142c1d0</span><span class="o">&gt;</span><span class="p">{</span><span class="n">number</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">main</span><span class="p">}</span><span class="o">----</span><span class="mi">3</span>
</span></code></pre></td></tr></table></div></figure>




<ul>
<li> 串行异步 （开启一个子线程，在子线程中执行）</li>
</ul>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="kt">dispatch_queue_t</span> <span class="n">queue</span> <span class="o">=</span> <span class="n">dispatch_queue_create</span><span class="p">(</span><span class="s">&quot;etund&quot;</span><span class="p">,</span> <span class="n">DISPATCH_QUEUE_SERIAL</span><span class="p">);</span>
</span><span class='line'><span class="n">dispatch_async</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;%@---1&quot;</span><span class="p">,[</span><span class="bp">NSThread</span> <span class="n">currentThread</span><span class="p">]);</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'><span class="n">dispatch_async</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;%@---2&quot;</span><span class="p">,[</span><span class="bp">NSThread</span> <span class="n">currentThread</span><span class="p">]);</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'><span class="n">dispatch_async</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;%@---3&quot;</span><span class="p">,[</span><span class="bp">NSThread</span> <span class="n">currentThread</span><span class="p">]);</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/*运行结果</span>
</span><span class='line'><span class="cm"> 2015-07-08 19:25:37.811 Pthread-多平台[68041:316565] &lt;NSThread: 0x7fb35850fe30&gt;{number = 3, name = (null)}---1</span>
</span><span class='line'><span class="cm"> 2015-07-08 19:25:37.811 Pthread-多平台[68041:316565] &lt;NSThread: 0x7fb35850fe30&gt;{number = 3, name = (null)}---2</span>
</span><span class='line'><span class="cm"> 2015-07-08 19:25:37.811 Pthread-多平台[68041:316565] &lt;NSThread: 0x7fb35850fe30&gt;{number = 3, name = (null)}---3</span>
</span><span class='line'><span class="cm"> */</span>
</span></code></pre></td></tr></table></div></figure>




<ul>
<li> 并行异步（全局队列异步）虽然线程的执行顺序不一样，但是任务从队列里面拿出来放进线程的顺序是按照先进先出的这是根本，基础。（有几个任务，开启几个子线程，在各自的子线程中执行）</li>
</ul>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="kt">dispatch_queue_t</span> <span class="n">queue</span> <span class="o">=</span> <span class="n">dispatch_queue_create</span><span class="p">(</span><span class="s">&quot;etund&quot;</span><span class="p">,</span> <span class="n">DISPATCH_QUEUE_CONCURRENT</span><span class="p">);</span>
</span><span class='line'><span class="n">dispatch_async</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;%@---1&quot;</span><span class="p">,[</span><span class="bp">NSThread</span> <span class="n">currentThread</span><span class="p">]);</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'><span class="n">dispatch_async</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;%@---2&quot;</span><span class="p">,[</span><span class="bp">NSThread</span> <span class="n">currentThread</span><span class="p">]);</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'><span class="n">dispatch_async</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;%@---3&quot;</span><span class="p">,[</span><span class="bp">NSThread</span> <span class="n">currentThread</span><span class="p">]);</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'><span class="c1">//   虽然线程的执行顺序不一样，但是任务从队列里面拿出来放进线程的顺序是按照先进先出</span>
</span><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm"> *2015-07-08 19:27:46.060 Pthread-多平台[68694:318231] &lt;NSThread: 0x7f9a89c126b0&gt;{number = 4, name = (null)}---2</span>
</span><span class='line'><span class="cm"> 2015-07-08 19:27:46.060 Pthread-多平台[68694:318230] &lt;NSThread: 0x7f9a8c211400&gt;{number = 5, name = (null)}---3</span>
</span><span class='line'><span class="cm"> 2015-07-08 19:27:46.060 Pthread-多平台[68694:318171] &lt;NSThread: 0x7f9a89f9efe0&gt;{number = 3, name = (null)}---1</span>
</span><span class='line'><span class="cm"> */</span>
</span></code></pre></td></tr></table></div></figure>




<ul>
<li> 主队列异步,不开任何子线程，在主线程中运行，也对应了那句话，异步队列只是具有开启子线程的能力，但是不一定开子线程。</li>
</ul>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">//    主队列异步(不开线程)</span>
</span><span class='line'><span class="n">dispatch_async</span><span class="p">(</span><span class="n">dispatch_get_main_queue</span><span class="p">(),</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;%@---1&quot;</span><span class="p">,[</span><span class="bp">NSThread</span> <span class="n">currentThread</span><span class="p">]);</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'><span class="n">dispatch_async</span><span class="p">(</span><span class="n">dispatch_get_main_queue</span><span class="p">(),</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;%@---2&quot;</span><span class="p">,[</span><span class="bp">NSThread</span> <span class="n">currentThread</span><span class="p">]);</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'><span class="n">dispatch_async</span><span class="p">(</span><span class="n">dispatch_get_main_queue</span><span class="p">(),</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;%@---3&quot;</span><span class="p">,[</span><span class="bp">NSThread</span> <span class="n">currentThread</span><span class="p">]);</span> <span class="p">;</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm"> 2015-07-08 19:34:25.440 Pthread-多平台[70710:322816] &lt;NSThread: 0x7fe0d1418200&gt;{number = 1, name = main}---1</span>
</span><span class='line'><span class="cm"> 2015-07-08 19:34:25.440 Pthread-多平台[70710:322816] &lt;NSThread: 0x7fe0d1418200&gt;{number = 1, name = main}---2</span>
</span><span class='line'><span class="cm"> 2015-07-08 19:34:25.440 Pthread-多平台[70710:322816] &lt;NSThread: 0x7fe0d1418200&gt;{number = 1, name = main}---3</span>
</span><span class='line'><span class="cm"> */</span>
</span></code></pre></td></tr></table></div></figure>




<ul>
<li> 主队列同步</li>
</ul>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'>    <span class="o">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="n">gcdTest_2_4</span><span class="p">{</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;=-=-=-&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">//    主队列同步(阻塞)</span>
</span><span class='line'>    <span class="n">dispatch_sync</span><span class="p">(</span><span class="n">dispatch_get_main_queue</span><span class="p">(),</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;%@---1&quot;</span><span class="p">,[</span><span class="bp">NSThread</span> <span class="n">currentThread</span><span class="p">]);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>    <span class="n">dispatch_sync</span><span class="p">(</span><span class="n">dispatch_get_main_queue</span><span class="p">(),</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;%@---2&quot;</span><span class="p">,[</span><span class="bp">NSThread</span> <span class="n">currentThread</span><span class="p">]);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>    <span class="n">dispatch_sync</span><span class="p">(</span><span class="n">dispatch_get_main_queue</span><span class="p">(),</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;%@---3&quot;</span><span class="p">,[</span><span class="bp">NSThread</span> <span class="n">currentThread</span><span class="p">]);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;=-=-=-&quot;</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<hr />




<p>至此，基本GCD队列已经被差不多就这样了，下面来一下有趣的用法
    - GCD队列组，有这么一个需求，你的一个步骤要在其他步骤完成之后才能完成，也就是后续步骤要依赖于前期步骤，这是GCD队列组以及Barrier队列(栅栏队列)不失为一个好办法，</p>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">//GCD队列组方式</span>
</span><span class='line'>        <span class="c1">//    (线程组)(线程通讯)</span>
</span><span class='line'><span class="c1">//    dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);</span>
</span><span class='line'>    <span class="kt">dispatch_queue_t</span> <span class="n">queue</span> <span class="o">=</span> <span class="n">dispatch_get_global_queue</span><span class="p">(</span><span class="n">DISPATCH_QUEUE_PRIORITY_DEFAULT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>    <span class="kt">dispatch_group_t</span> <span class="n">group</span> <span class="o">=</span> <span class="n">dispatch_group_create</span><span class="p">();</span>
</span><span class='line'>    <span class="c1">//    加载图片1</span>
</span><span class='line'>    <span class="n">dispatch_group_async</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">queue</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="bp">NSURL</span> <span class="o">*</span><span class="n">url</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSURL</span> <span class="nl">URLWithString</span><span class="p">:</span><span class="s">@&quot;http://f.hiphotos.baidu.com/image/pic/item/d788d43f8794a4c2e882eb8b0df41bd5ac6e39e8.jpg&quot;</span><span class="p">];</span>
</span><span class='line'>        <span class="bp">NSData</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSData</span> <span class="nl">dataWithContentsOfURL</span><span class="p">:</span><span class="n">url</span><span class="p">];</span>
</span><span class='line'>        <span class="nb">self</span><span class="p">.</span><span class="n">image1</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIImage</span> <span class="nl">imageWithData</span><span class="p">:</span><span class="n">data</span><span class="p">];</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>    <span class="c1">//    加载图片2</span>
</span><span class='line'>    <span class="n">dispatch_group_async</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">queue</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="bp">NSURL</span> <span class="o">*</span><span class="n">url</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSURL</span> <span class="nl">URLWithString</span><span class="p">:</span><span class="s">@&quot;http://h.hiphotos.baidu.com/image/pic/item/ac6eddc451da81cbd668501c5666d01608243151.jpg&quot;</span><span class="p">];</span>
</span><span class='line'>        <span class="bp">NSData</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSData</span> <span class="nl">dataWithContentsOfURL</span><span class="p">:</span><span class="n">url</span><span class="p">];</span>
</span><span class='line'>        <span class="nb">self</span><span class="p">.</span><span class="n">image2</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIImage</span> <span class="nl">imageWithData</span><span class="p">:</span><span class="n">data</span><span class="p">];</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">//    合并</span>
</span><span class='line'>    <span class="n">dispatch_group_notify</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">queue</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="n">UIGraphicsBeginImageContextWithOptions</span><span class="p">(</span><span class="n">CGSizeMake</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="nb">NO</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>        <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">image1</span> <span class="nl">drawAsPatternInRect</span><span class="p">:</span><span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">)];</span>
</span><span class='line'>        <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">image2</span> <span class="nl">drawAsPatternInRect</span><span class="p">:</span><span class="n">CGRectMake</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">)];</span>
</span><span class='line'>        <span class="bp">UIImage</span> <span class="o">*</span><span class="n">image</span> <span class="o">=</span> <span class="n">UIGraphicsGetImageFromCurrentImageContext</span><span class="p">();</span>
</span><span class='line'>        <span class="n">UIGraphicsEndImageContext</span><span class="p">();</span>
</span><span class='line'>        <span class="c1">//GCD线程之间的通信</span>
</span><span class='line'>        <span class="n">dispatch_async</span><span class="p">(</span><span class="n">dispatch_get_main_queue</span><span class="p">(),</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>            <span class="nb">self</span><span class="p">.</span><span class="n">myView</span><span class="p">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="p">;</span>
</span><span class='line'>        <span class="p">});</span>
</span><span class='line'>        <span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//栅栏dispatch_barrier方式</span>
</span><span class='line'>        <span class="kt">dispatch_queue_t</span> <span class="n">queue</span> <span class="o">=</span> <span class="n">dispatch_queue_create</span><span class="p">(</span><span class="s">&quot;etund&quot;</span><span class="p">,</span> <span class="n">DISPATCH_QUEUE_CONCURRENT</span><span class="p">);</span><span class="c1">//创建多个线程</span>
</span><span class='line'>    <span class="n">dispatch_async</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="bp">NSURL</span> <span class="o">*</span><span class="n">url</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSURL</span> <span class="nl">URLWithString</span><span class="p">:</span><span class="s">@&quot;http://f.hiphotos.baidu.com/image/pic/item/d788d43f8794a4c2e882eb8b0df41bd5ac6e39e8.jpg&quot;</span><span class="p">];</span>
</span><span class='line'>        <span class="bp">NSData</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSData</span> <span class="nl">dataWithContentsOfURL</span><span class="p">:</span><span class="n">url</span><span class="p">];</span>
</span><span class='line'>        <span class="nb">self</span><span class="p">.</span><span class="n">image1</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIImage</span> <span class="nl">imageWithData</span><span class="p">:</span><span class="n">data</span><span class="p">];</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>    <span class="n">dispatch_async</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="bp">NSURL</span> <span class="o">*</span><span class="n">url</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSURL</span> <span class="nl">URLWithString</span><span class="p">:</span><span class="s">@&quot;http://h.hiphotos.baidu.com/image/pic/item/ac6eddc451da81cbd668501c5666d01608243151.jpg&quot;</span><span class="p">];</span>
</span><span class='line'>        <span class="bp">NSData</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSData</span> <span class="nl">dataWithContentsOfURL</span><span class="p">:</span><span class="n">url</span><span class="p">];</span>
</span><span class='line'>        <span class="nb">self</span><span class="p">.</span><span class="n">image2</span> <span class="o">=</span> <span class="p">[</span><span class="bp">UIImage</span> <span class="nl">imageWithData</span><span class="p">:</span><span class="n">data</span><span class="p">];</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">dispatch_barrier_async</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">dispatch_async</span><span class="p">(</span><span class="n">queue</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="n">UIGraphicsBeginImageContextWithOptions</span><span class="p">(</span><span class="n">CGSizeMake</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="nb">NO</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>        <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">image1</span> <span class="nl">drawAsPatternInRect</span><span class="p">:</span><span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">)];</span>
</span><span class='line'>        <span class="p">[</span><span class="nb">self</span><span class="p">.</span><span class="n">image2</span> <span class="nl">drawAsPatternInRect</span><span class="p">:</span><span class="n">CGRectMake</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">)];</span>
</span><span class='line'>        <span class="bp">UIImage</span> <span class="o">*</span><span class="n">image</span> <span class="o">=</span> <span class="n">UIGraphicsGetImageFromCurrentImageContext</span><span class="p">();</span>
</span><span class='line'>        <span class="n">UIGraphicsEndImageContext</span><span class="p">();</span>
</span><span class='line'>        <span class="n">dispatch_async</span><span class="p">(</span><span class="n">dispatch_get_main_queue</span><span class="p">(),</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>            <span class="nb">self</span><span class="p">.</span><span class="n">myView</span><span class="p">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="p">;</span>
</span><span class='line'>        <span class="p">});</span>
</span><span class='line'>    <span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>




<ul>
<li>延迟加载</li>
</ul>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'> <span class="n">dispatch_after</span><span class="p">(</span><span class="n">dispatch_time</span><span class="p">(</span><span class="n">DISPATCH_TIME_NOW</span><span class="p">,</span> <span class="p">(</span><span class="kt">int64_t</span><span class="p">)(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">NSEC_PER_SEC</span><span class="p">)),</span> <span class="n">dispatch_get_main_queue</span><span class="p">(),</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>    <span class="c1">// 2秒后异步执行这里的代码...</span>
</span><span class='line'><span class="p">});</span>
</span></code></pre></td></tr></table></div></figure>




<ul>
<li>快速迭代，当我们不需要注重迭代的顺序，只需要快速获得子元素的时候，GCD的快速迭代为你提供了途径</li>
</ul>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="c1">//    (快速迭代)</span>
</span><span class='line'><span class="kt">dispatch_queue_t</span> <span class="n">queue</span> <span class="o">=</span> <span class="n">dispatch_get_global_queue</span><span class="p">(</span><span class="n">DISPATCH_QUEUE_PRIORITY_DEFAULT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'><span class="n">dispatch_apply</span><span class="p">(</span><span class="nb">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">subviews</span><span class="p">.</span><span class="n">count</span><span class="p">,</span> <span class="n">queue</span><span class="p">,</span> <span class="o">^</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">index</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kt">id</span> <span class="n">obj</span> <span class="o">=</span> <span class="nb">self</span><span class="p">.</span><span class="n">view</span><span class="p">.</span><span class="n">subviews</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;---%zu---%@&quot;</span><span class="p">,</span><span class="n">index</span><span class="p">,</span><span class="n">obj</span><span class="p">);</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'><span class="cm">/*</span>
</span><span class='line'><span class="cm">2015-07-08 22:26:39.851 Pthread-多平台[972:17366] ---0---&lt;_UILayoutGuide: 0x7fd86b644e00; frame = (0 0; 0 20); hidden = YES; layer = &lt;CALayer: 0x7fd86b643ab0&gt;&gt;</span>
</span><span class='line'><span class="cm">2015-07-08 22:26:39.851 Pthread-多平台[972:17444] ---2---&lt;UIImageView: 0x7fd86b645ba0; frame = (100 100; 100 100); clipsToBounds = YES; userInteractionEnabled = NO; layer = &lt;CALayer: 0x7fd86b643290&gt;&gt;</span>
</span><span class='line'><span class="cm">2015-07-08 22:26:39.851 Pthread-多平台[972:17435] ---1---&lt;_UILayoutGuide: 0x7fd86b6457b0; frame = (0 568; 0 0); hidden = YES; layer = &lt;CALayer: 0x7fd86b644040&gt;&gt;</span>
</span><span class='line'><span class="cm"> */</span>
</span></code></pre></td></tr></table></div></figure>




<ul>
<li>once一次性代码（单例模式设计）,有时候我们需要用到单例模式做一些操作例如：传值时，就会用到单例设计模式，设计单例模式的方法很多，其中最重要的是要做到线程安全，而GCD就提供了这么一个结构体来保证在创建单例过程中的线程安全</li>
</ul>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">ETPerson</span><span class="p">.</span><span class="n">h</span>
</span><span class='line'><span class="o">+</span> <span class="p">(</span><span class="kt">instancetype</span><span class="p">)</span><span class="n">sharePerson</span><span class="p">;</span>
</span><span class='line'><span class="n">ETPerson</span><span class="p">.</span><span class="n">m</span>
</span><span class='line'><span class="k">@implementation</span> <span class="nc">ETPerson</span>
</span><span class='line'><span class="k">static</span> <span class="n">ETPerson</span> <span class="o">*</span><span class="n">_person</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="p">+</span> <span class="p">(</span><span class="kt">instancetype</span><span class="p">)</span><span class="nf">sharePerson</span><span class="p">{</span>
</span><span class='line'>    <span class="k">static</span> <span class="kt">dispatch_once_t</span> <span class="n">onceDispatch</span><span class="p">;</span>
</span><span class='line'>    <span class="n">dispatch_once</span><span class="p">(</span><span class="o">&amp;</span><span class="n">onceDispatch</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="n">_person</span> <span class="o">=</span> <span class="p">[[</span><span class="n">ETPerson</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">_person</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="p">+</span> <span class="p">(</span><span class="kt">instancetype</span><span class="p">)</span><span class="nf">allocWithZone:</span><span class="p">(</span><span class="k">struct</span> <span class="bp">_NSZone</span> <span class="o">*</span><span class="p">)</span><span class="nv">zone</span><span class="p">{</span>
</span><span class='line'>    <span class="k">static</span> <span class="kt">dispatch_once_t</span> <span class="n">onceDispatch</span><span class="p">;</span>
</span><span class='line'>    <span class="n">dispatch_once</span><span class="p">(</span><span class="o">&amp;</span><span class="n">onceDispatch</span><span class="p">,</span> <span class="o">^</span><span class="p">{</span>
</span><span class='line'>        <span class="n">_person</span> <span class="o">=</span> <span class="p">[</span><span class="nb">super</span> <span class="nl">allocWithZone</span><span class="p">:</span><span class="n">zone</span><span class="p">];</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">_person</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="p">-</span> <span class="p">(</span><span class="kt">id</span><span class="p">)</span><span class="nf">copyWithZone:</span><span class="p">(</span><span class="n">NSZone</span> <span class="o">*</span><span class="p">)</span><span class="nv">zone</span><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">_person</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="k">@end</span>
</span><span class='line'><span class="err">调用</span>
</span><span class='line'><span class="c1">//    onece(单例)</span>
</span><span class='line'>    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;%@----%@------%@-------%@------%@-----%@&quot;</span><span class="p">,[[</span><span class="n">ETPerson</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">],[[</span><span class="n">ETPerson</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">],[</span><span class="n">ETPerson</span> <span class="k">copy</span><span class="p">],[</span><span class="n">ETPerson</span> <span class="k">copy</span><span class="p">],[</span><span class="n">ETPerson</span> <span class="n">sharePerson</span><span class="p">],[</span><span class="n">ETPerson</span> <span class="n">sharePerson</span><span class="p">]);</span>
</span><span class='line'>    <span class="cm">/*运行结果</span>
</span><span class='line'><span class="cm">     2015-07-08 23:26:57.292 Pthread-多平台[1350:37528] &lt;ETPerson: 0x7fc4bb4041c0&gt;----&lt;ETPerson: 0x7fc4bb4041c0&gt;------ETPerson-------ETPerson------&lt;ETPerson: 0x7fc4bb4041c0&gt;-----&lt;ETPerson: 0x7fc4bb4041c0&gt;</span>
</span><span class='line'><span class="cm">     */</span>
</span></code></pre></td></tr></table></div></figure>




  </p>
  <span class="meta">
    written 








  


<time datetime="2015-07-08T20:30:48+08:00" data-updated="true" itemprop="datePublished"></time>
    


  </span>

  
</article>

        </div>
      </div>
      
      
      <div class="row">
        <div class="col-md-offset-3 col-md-6">
          <article>
  <h2><a href="/blog/2015/06/21/runloopshen-du-pou-xi/">RunLoop深度剖析</a></h2>
  
  <p>
    <h1>RunLoop</h1>




<h2>前言</h2>




<ul>
<li><p>RunLoop是iOS/OS开发中比较基础的一个概念，在苹果开发中用在事件处理，延迟加载，屏幕刷新等功能的处理，其实抛开语言，RunLoop是一个的架构模式，也就是RunLoop不仅仅局限于iOS开发。</p></li>
<li><p>网上有很多关于RunLoop的干货，但大多不怎么全，这位哥们的写的挺好的，挺详细的，基本上把要说的都说了，底层也研究的很细，本文基本上是转载他的，只是在它的基础上，基于我的知识水平补充了一些，<a href="http://www.cocoachina.com/ios/20150601/11970.html">原文</a></p></li>
<li><p>官方有已经有<a href="https://developer.apple.com/library/mac/documentation/Cocoa/Conceptual/Multithreading/RunLoopManagement/RunLoopManagement.html">关于RunLoop的官方文档</a>，英语的，不过网上已经有人把它翻译为中文了，大家可以去看看.</p></li>
</ul>




  </p>
  <span class="meta">
    written 








  


<time datetime="2015-06-21T22:13:01+08:00" data-updated="true" itemprop="datePublished"></time>
    


  </span>

  
    <a class="full-article-link pull-right" rel="full-article" href="/blog/2015/06/21/runloopshen-du-pou-xi/">阅读全文</a>
  
</article>

        </div>
      </div>
      
      
      <div class="row">
        <div class="col-md-offset-3 col-md-6">
          <article>
  <h2><a href="/blog/2015/02/25/bai-si-bu-de-jie-xiang-mu-zong-jie-wu/">百思不得姐-项目总结(五)</a></h2>
  
  <p>
    <h3>功能模块实现(部分)</h3>




<h5>自定义UITextView</h5>




<ul>
<li>添加内容输入框。

<ul>
<li>内嵌</li>
<li>自定义UITextView

<ul>
<li>占位字符</li>
</ul>
</li>
<li>监听textView的输入值，用于去除占位字符，不能从外面监听，这是可以在内部通过通知的方式来监听。</li>
</ul>
</li>
</ul>




  </p>
  <span class="meta">
    written 








  


<time datetime="2015-02-25T19:50:39+08:00" data-updated="true" itemprop="datePublished"></time>
    


  </span>

  
    <a class="full-article-link pull-right" rel="full-article" href="/blog/2015/02/25/bai-si-bu-de-jie-xiang-mu-zong-jie-wu/">阅读全文</a>
  
</article>

        </div>
      </div>
      
      
      <div class="row">
        <div class="col-md-offset-3 col-md-6">
          <article>
  <h2><a href="/blog/2015/02/24/bai-si-bu-de-jie-xiang-mu-zong-jie-si/">百思不得姐-项目总结(四)</a></h2>
  
  <p>
    <h3>哪些网上找不到的经验(二)</h3>




<ul>
<li>将约束对象翻转

<ul>
<li>这样做可以让父控件随着子控件的变化而变化，而不是子控件随着父控件的变化而变化。</li>
</ul>
</li>
<li>placeholderlabel是懒加载的。

<pre><code>  - 所以利用KVC设置placeholderlabel的颜色属性的时候要placeholderlabel是否为空。
</code></pre></li>
<li>如果我们的控件从xid加载

<ul>
<li>可以在layoutsubview方法里面设置控件尺寸</li>
<li>排布子控件不管是从xib加载还是代码加载都不受控制，可以在layoutsubview里面设置</li>
</ul>
</li>
</ul>




  </p>
  <span class="meta">
    written 








  


<time datetime="2015-02-24T19:47:07+08:00" data-updated="true" itemprop="datePublished"></time>
    


  </span>

  
    <a class="full-article-link pull-right" rel="full-article" href="/blog/2015/02/24/bai-si-bu-de-jie-xiang-mu-zong-jie-si/">阅读全文</a>
  
</article>

        </div>
      </div>
      
      
      <div class="row">
        <div class="col-md-offset-3 col-md-6">
          <article>
  <h2><a href="/blog/2015/02/23/bai-si-bu-de-jie-xiang-mu-zong-jie-san/">百思不得姐-项目总结(三)</a></h2>
  
  <p>
    <h3>哪些网上找不到的经验(一)</h3>




<ul>
<li>[UIColor colorWithPatternImage:]设置颜色跟图片一致</li>
<li>属性后面有Appearance宏，都可以通过Appearance统一设置，例如：UITabarItem</li>
<li>在分类中声明Property，只会声明方法声明，不会生成方法的实现和下划线属性。</li>
<li>用imageView的initWithImage图片尺寸会与imageView一样</li>
<li>如果navbarItem里面是文件，那么item接受事件，如果是Button，那么改button接收事件</li>
<li>按住Option加回车，UILabel可以换行</li>
</ul>




  </p>
  <span class="meta">
    written 








  


<time datetime="2015-02-23T19:26:47+08:00" data-updated="true" itemprop="datePublished"></time>
    


  </span>

  
    <a class="full-article-link pull-right" rel="full-article" href="/blog/2015/02/23/bai-si-bu-de-jie-xiang-mu-zong-jie-san/">阅读全文</a>
  
</article>

        </div>
      </div>
      
      
      <div class="row">
        <div class="col-md-offset-3 col-md-6">
          <article>
  <h2><a href="/blog/2015/02/21/bai-si-bu-de-jie-xiang-mu-zong-jie-er/">百思不得姐-项目总结(二)</a></h2>
  
  <p>
    <h3>小技巧(二)</h3>




<h4>双击菜单栏回到顶部？点击屏幕顶部回到最上面？</h4>




<ul>
<li><p>在整个应用启动的时候在应用顶部添加一个window用于点击，然后再监听这个window的点击事件。</p></li>
<li><p>自己自顶一个而一个类，继承window或者NSObject都行，然后定义一个window_成员变量。</p></li>
</ul>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="n">window_</span> <span class="o">=</span> <span class="p">[[</span><span class="bp">UIWindow</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'>    <span class="n">window_</span><span class="p">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">CGRectMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ETScreenW</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
</span><span class='line'>    <span class="n">window_</span><span class="p">.</span><span class="n">windowLevel</span> <span class="o">=</span> <span class="n">UIWindowLevelAlert</span><span class="p">;</span>
</span><span class='line'>    <span class="p">[</span><span class="n">window_</span> <span class="nl">addGestureRecognizer</span><span class="p">:[[</span><span class="bp">UITapGestureRecognizer</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithTarget</span><span class="p">:</span><span class="nb">self</span> <span class="nl">action</span><span class="p">:</span><span class="k">@selector</span><span class="p">(</span><span class="n">windowClick</span><span class="p">)]];</span>
</span></code></pre></td></tr></table></div></figure>




  </p>
  <span class="meta">
    written 








  


<time datetime="2015-02-21T19:08:55+08:00" data-updated="true" itemprop="datePublished"></time>
    


  </span>

  
    <a class="full-article-link pull-right" rel="full-article" href="/blog/2015/02/21/bai-si-bu-de-jie-xiang-mu-zong-jie-er/">阅读全文</a>
  
</article>

        </div>
      </div>
      
      
      <div class="row">
        <div class="col-md-offset-3 col-md-6">
          <article>
  <h2><a href="/blog/2015/02/20/bai-si-bu-de-jie-xiang-mu-zong-jie-%5B%3F%5D/">百思不得姐-项目总结(一)</a></h2>
  
  <p>
    <h3>前言</h3>




<ul>
<li>这个项目是一个段子类的项目，百思不得姐，一个段子软件，具体情况自己下载来玩吧。</li>
</ul>




  </p>
  <span class="meta">
    written 








  


<time datetime="2015-02-20T18:54:55+08:00" data-updated="true" itemprop="datePublished"></time>
    


  </span>

  
    <a class="full-article-link pull-right" rel="full-article" href="/blog/2015/02/20/bai-si-bu-de-jie-xiang-mu-zong-jie-%5B%3F%5D/">阅读全文</a>
  
</article>

        </div>
      </div>
      
      
      <div class="row">
        <div class="col-md-offset-3 col-md-6">
          <article>
  <h2><a href="/blog/2014/11/07/wen-jian-xia-zai-er/">文件下载(二)</a></h2>
  
  <p>
    <h3>NSURLSession多文件断点下载</h3>




<ul>
<li>上次已经完成了单文件断点下载，现在就开始实现多文件断点下载，接下来要实现单文件下载。</li>
<li>为了方便，把之前在文件控制器文件中的下载文件抽取出来，封装成一个专门用来下载的类，假设我们调用方法，只需要存进一个url，这个工具类就会默认的把我们的下载好的文件放进cache文件里面，并且不断返回进度，于是乎我们假设封装好的方法是这样的。</li>
</ul>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>NSString *remoteURL = @"http://120.25.226.186:32812/resources/videos/minion_01.mp4";
</span><span class='line'>    [ETURLDownLoadSession downloadWithURL:remoteURL complete:^(CGFloat downLoadScale) {
</span><span class='line'>        NSLog(@"-------------%f",downLoadScale);
</span><span class='line'>    }];</span></code></pre></td></tr></table></div></figure>




<ul>
<li><p>亦即是说我们只需要调用ETURLDownLoadSession的类方法就可以实现多文件断点下载了，接下来我们就要实现这个类方法了。</p></li>
<li><p>我们在封装类里面是通过类方法类调用实例方法的，就像这样。</p></li>
</ul>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#pragma mark -  初始化方法
</span><span class='line'>+ (void)downloadWithURL:(NSString *)remoteURL complete:(void (^)(CGFloat downLoadScale))complete{    
</span><span class='line'>    ETURLDownLoadSession *downLoad = [[ETURLDownLoadSession alloc] init];
</span><span class='line'>    [downLoad downloadWithURL:remoteURL complete:complete];
</span><span class='line'>}
</span><span class='line'>
</span><span class='line'>- (void)downloadWithURL:(NSString *)remoteURL complete:(void (^)(CGFloat downLoadScale))complete{
</span><span class='line'>    self.remoteURL = remoteURL;
</span><span class='line'>    [self downLoad];
</span><span class='line'>    if (complete) {
</span><span class='line'>        complete(self.downLoadScale)
</span><span class='line'>    }
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>




<ul>
<li><p>downLoadSacle是在NSURLSession代理方法中接受数据的方法里面已经接受的数据的比例。但是这里发现，只是在初始方法里面执行一次，那么我们在外头想时刻知道下载比例的变化，要怎么做呢？分析一下。</p>

<ul>
<li>首先，要时刻执行block，而block的下载比例是时刻变化的，这是使用KVO再适合不过了。</li>
<li>然后block就不是在初始化方法里面执行了，要在监听值变化的方法里面执行，于是乎要把block前值为全局变量，首先的定义一个跟传进来block一样的block类型。</li>
</ul>


<pre><code class="``">  //定义block类型
  typedef void (^scaleChangeBlock)(CGFloat downloadScale);
  //定义block变量
  @property (nonatomic, strong) scaleChangeBlock scaleBlock;
</code></pre></li>
<li><p>于是乎在- (void)downloadWithURL:(NSString *)remoteURL complete:(void (^)(CGFloat downLoadScale))complete;方法里面添加Observer来监听KVO的变化。</p></li>
</ul>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>//    添加KVO
</span><span class='line'>    [self addObserver:self forKeyPath:@"downLoadScale" options:NSKeyValueObservingOptionNew context:nil];
</span><span class='line'>    self.remoteURL = remoteURL;
</span><span class='line'>    [self downLoad];
</span><span class='line'>    if (complete) {
</span><span class='line'>        self.scaleBlock = complete;
</span><span class='line'>    }
</span><span class='line'>//在监听值变化的方法里面调用block
</span><span class='line'>    //开始监听
</span><span class='line'>- (void)observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary *)change context:(void *)context{
</span><span class='line'>    self.scaleBlock(self.downLoadScale);
</span><span class='line'>}
</span><span class='line'>//最后要记得在要移除值KVO
</span><span class='line'>#pragma mark - 移除KVO
</span><span class='line'>- (void)dealloc{
</span><span class='line'>    [self removeObserver:self forKeyPath:@"downLoadScale" context:nil];
</span><span class='line'>    NSLog(@"----dealoc--");
</span><span class='line'>    
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>




  </p>
  <span class="meta">
    written 








  


<time datetime="2014-11-07T17:32:40+08:00" data-updated="true" itemprop="datePublished"></time>
    


  </span>

  
</article>

        </div>
      </div>
      
      
      <div class="row">
        <div class="col-md-offset-3 col-md-6">
          <article>
  <h2><a href="/blog/2014/11/05/wen-jian-xia-zai-%5B%3F%5D/">文件断点下载(一)</a></h2>
  
  <p>
    <h2>NSURLSession单文件断点下载</h2>




<ul>
<li>介绍

<ul>
<li>NSURLSession是iOS7推出的，旨在提供比NSURLConenection方便的网络需求实现方式，并取缔他，也的确做到了，在iOS9NSURLConenection已经过期了，这里介绍利用NSURLSession的代理实现断点下载。</li>
</ul>
</li>
<li><p>思路</p>

<ul>
<li>初始化NSURLSession同时设置代理</li>
<li>初始化文件IO流</li>
<li>实现初级下载</li>
<li>在上次下载的地方重新下载</li>
</ul>


<p>  <code>额外需求</code></p>

<ul>
<li>实现当用户下载完成的时候下次下载不会再发请求</li>
</ul>
</li>
<li><p>在Session懒加载的设置代理</p></li>
</ul>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>_session = [NSURLSession sessionWithConfiguration:[NSURLSessionConfiguration defaultSessionConfiguration] delegate:self delegateQueue:[[NSOperationQueue alloc] init]];</span></code></pre></td></tr></table></div></figure>




<ul>
<li>实现代理方法，在收到用户点击的时候在task的懒加载的时候初始化task，并且开启任务</li>
</ul>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>    NSMutableURLRequest *request = [NSMutableURLRequest requestWithURL:[NSURL URLWithString:@"http://120.25.226.186:32812/resources/videos/minion_05.mp4"]];
</span><span class='line'>    _task = [self.session dataTaskWithRequest:request];</span></code></pre></td></tr></table></div></figure>




<ul>
<li>分别在接接收到数据，接收到响应，数据传输完成中座操作</li>
</ul>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>//接收到响应
</span><span class='line'>- (void)URLSession:(NSURLSession *)session dataTask:(NSURLSessionDataTask *)dataTask
</span><span class='line'>                                 didReceiveResponse:(NSURLResponse *)response
</span><span class='line'>                                  completionHandler:(void (^)(NSURLSessionResponseDisposition disposition))completionHandler;
</span><span class='line'>                                  
</span><span class='line'>//接收到数据
</span><span class='line'>- (void)URLSession:(NSURLSession *)session dataTask:(NSURLSessionDataTask *)dataTask- 
</span><span class='line'>                                     didReceiveData:(NSData *)data;
</span><span class='line'>//数据传输完成
</span><span class='line'>- (void)URLSessionDidFinishEventsForBackgroundURLSession:(NSURLSession *)session NS_AVAILABLE_IOS(7_0);</span></code></pre></td></tr></table></div></figure>




<ul>
<li>在接收到响应的时候开启数据IO流，并且设置可以接受数据(NSURLSession要默认不会接受数据，要手动设置接受数据)</li>
</ul>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>//    开启数据io流
</span><span class='line'>    [self.outStream open];
</span><span class='line'>//    设置接受数据
</span><span class='line'>    completionHandler(NSURLSessionResponseAllow);</span></code></pre></td></tr></table></div></figure>




<ul>
<li>在接收到数据的时候用IO流把数据写入文件</li>
</ul>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>//    获取本地文件的大小
</span><span class='line'>    [self.outStream write:data.bytes maxLength:data.length];</span></code></pre></td></tr></table></div></figure>




<ul>
<li>在数据接收完毕的时候关闭流</li>
</ul>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[self.outStream close];
</span><span class='line'>self.outStream = nil;</span></code></pre></td></tr></table></div></figure>




<ul>
<li>现在，是可以实现数据传入，并且按暂停可以暂停，按重新开始也可以开始了。</li>
<li>然而，当有电话打过来的时候或者用户异常退出的时候用户再进入，下载的时候，任务又重新开始了。</li>
<li>这是我们可以这样实现，拿到当前已经下载文件的大小，而后在HTTP协议中告诉服务器，我们从当前文件大小后面的字节数开始下载，于是乎，在定义request的时候设置HTTP请求头的属性。</li>
</ul>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>    NSString *range = [NSString stringWithFormat:@"bytes=%zd-",[[[NSFileManager defaultManager] attributesOfItemAtPath:ETFileSavePath error:nil][NSFileSize] integerValue]];
</span><span class='line'>    [request setValue:range forHTTPHeaderField:@"Range"];</span></code></pre></td></tr></table></div></figure>




<ul>
<li><p>现在是可以做到下载文件中用户直接退出或者来电话的时候实现断点下载。</p></li>
<li><p>现在可以完善细节</p>

<ul>
<li>看一下我们的额外需求，实现当用户下载完成的时候下次下载不会再发请求，按照我们原来的代码，虽然说可以实现当下载完成的时候不会再继续下载，但是这是因为我们每次都会获取当前文件的大小，然后再跟服务器说我们从最后一个字节开始，然而肯定没有字节下载。</li>
<li>额，我们想不发送请求直接可以想判断当前是否已经下载完成，于是乎可以这样，在创建发送请求的时候获取总文件大小，每次创建Task的时候判断下载的文件和总文件大小是否一致并且不为0再来判断是否要创建Task</li>
</ul>


<pre><code class="`">//在懒加载Task的时候
//        获取上次存储的文件长度
//        这样做的需求是为了不浪费用户的流量
      NSInteger lastTimeLength = [[NSDictionary dictionaryWithContentsOfFile:ETFileLeggthSavePath][ETSavedFieldName]
                                  integerValue];
      if (lastTimeLength!=0 &amp;&amp; lastTimeLength==ETSavedFileSize) {
//            NSLog(@"==========%f",(1.0 * ETSavedFileSize/lastTimeLength));
          NSLog(@"已经下载过了");
          return nil;
      }
//在接收到响应的代理方法的时候加上
    //    记录下载数据流
  self.dataLength = [response.allHeaderFields[@"Content-Length"] integerValue] + ETSavedFileSize;

  //    存储本次文件的长度
  //    记录下载数据流
  self.dataLength = [response.allHeaderFields[@"Content-Length"] integerValue] + ETSavedFileSize;


  //    记录下载数据流
  self.dataLength = [response.allHeaderFields[@"Content-Length"] integerValue] + ETSavedFileSize;
  //    存储本次文件的长度
  [@{ETSavedFieldName:@(self.dataLength)} writeToFile:ETFileLeggthSavePath atomically:YES];
</code></pre></li>
<li>额，然后这样是可以在每次启动不发流量的前提下检查是否已经下载完成，但是想到，文件大小应该是一开始到最后都是一样的，那么我们为什么要每次存储呢？我们只需要存储一次就好了。</li>
</ul>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'> //    先取出存储的文件长度是否已经存在
</span><span class='line'>    NSInteger lastTimeLength = [[NSDictionary dictionaryWithContentsOfFile:ETFileLeggthSavePath][ETSavedFieldName] integerValue];
</span><span class='line'>    if (!lastTimeLength){
</span><span class='line'>        //    存储本次文件的长度
</span><span class='line'>        [@{ETSavedFieldName:@(self.dataLength)} writeToFile:ETFileLeggthSavePath atomically:YES];
</span><span class='line'>    } </span></code></pre></td></tr></table></div></figure>




<ul>
<li>至此，我们实现了一些需求

<ul>
<li>可以实现文件在线断点下载</li>
<li>可以在我们不正常退出正在下载任务的时候从新开始下载。</li>
<li>可以实现在用户下载完的时候不发请求检查任务是否已经下载完成。</li>
</ul>
</li>
<li>单文件下载基本上是可以了。</li>
</ul>




  </p>
  <span class="meta">
    written 








  


<time datetime="2014-11-05T17:29:20+08:00" data-updated="true" itemprop="datePublished"></time>
    


  </span>

  
</article>

        </div>
      </div>
      
      
      <div class="row">
        <div class="col-md-offset-3 col-md-6">
          <article>
  <h2><a href="/blog/2014/08/22/qian-kao-bei-yu-shen-kao-bei/">浅拷贝与深拷贝</a></h2>
  
  <p>
    <h4>深拷贝与浅拷贝</h4>




<ul>
<li>浅拷贝是指针拷贝，深拷贝是内容拷贝</li>
<li>产生新对象的时深拷贝，不产生新对象的时浅拷贝</li>
<li><p>浅拷贝只是对对象的简单拷贝，让几个对象公用一片内存，当内存销毁的时候，只想这片内存的额几个指针需要重新定义才可以使用，要不然会变成野指针。</p></li>
<li><p>NString与copy(不产生新对象，浅拷贝，指针拷贝)</p></li>
</ul>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="bp">NSString</span> <span class="o">*</span><span class="n">str</span> <span class="o">=</span> <span class="s">@&quot;00000000000&quot;</span><span class="p">;</span>
</span><span class='line'><span class="bp">NSString</span> <span class="o">*</span><span class="n">str_0</span> <span class="o">=</span> <span class="p">[</span><span class="n">str</span> <span class="k">copy</span><span class="p">];</span>
</span><span class='line'><span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;%p---------%p&quot;</span><span class="p">,</span><span class="n">str</span><span class="p">,</span><span class="n">str_0</span><span class="p">);</span>
</span><span class='line'><span class="cm">/**输出结果</span>
</span><span class='line'><span class="cm">2015-08-22 12:42:24.992 Text[1143:32063] 0x10128c7d0---------0x10128c7d0</span>
</span><span class='line'><span class="cm">*/</span>
</span></code></pre></td></tr></table></div></figure>




<p></p>




  </p>
  <span class="meta">
    written 








  


<time datetime="2014-08-22T14:15:33+08:00" data-updated="true" itemprop="datePublished"></time>
    


  </span>

  
    <a class="full-article-link pull-right" rel="full-article" href="/blog/2014/08/22/qian-kao-bei-yu-shen-kao-bei/">阅读全文</a>
  
</article>

        </div>
      </div>
      
      
      <div class="row">
        <div class="col-md-offset-3 col-md-6">
          <article>
  <h2><a href="/blog/2014/07/28/objective-c-runtime-er/">Objective-C_Runtime(二)</a></h2>
  
  <p>
    <p><img src="/images/blog/Objective-c-Runtime/1436240778601754.jpg" alt="" /></p>




<h3>动态方法解析</h3>




<h4>动态方法解析</h4>




<ul>
<li>这里描述怎样动态提供一个方法的实现</li>
<li>有时候需要动态的提供一个方法的实现，例如OC中属性Property</li>
</ul>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'><span class="err">￼￼￼￼</span><span class="k">@dynamic</span> <span class="n">propertyName</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>




<ul>
<li>表示编译器须动态的生成该属性对应的方法，<code>注意：￼￼￼￼@dynamic与@property一样都可以自动生成setter和getter方法，知识@property是编译阶段生成的，而@dynamic是手工生成或者运行时自动生成。</code></li>
<li>此外，还可以通过实现resolveInstanceMethod;和resolveeClassMethod；来动态地实现给定选标的对象方法或者类方法。</li>
<li>OC方法可以认为是至少两个参数的self和_cmd的C函数。你可以通过class_andMethod方法讲一个函数加入到类的方法中。例如，有如下函数：</li>
</ul>




  </p>
  <span class="meta">
    written 








  


<time datetime="2014-07-28T19:43:52+08:00" data-updated="true" itemprop="datePublished"></time>
    


  </span>

  
    <a class="full-article-link pull-right" rel="full-article" href="/blog/2014/07/28/objective-c-runtime-er/">阅读全文</a>
  
</article>

        </div>
      </div>
      
      
      <div class="row">
        <div class="col-md-offset-3 col-md-6">
          <article>
  <h2><a href="/blog/2014/07/24/objective-c-runtime-%5B%3F%5D/">Objective-C_Runtime(一)</a></h2>
  
  <p>
    <p><img src="/images/blog/Objective-c-Runtime/1436240778601754.jpg" alt="" /></p>




<h3>前言</h3>




<ul>
<li>此博文仅仅用于本人的读书笔记，一切以官方的为准<a href="https://developer.apple.com/library/prerelease/mac/documentation/Cocoa/Conceptual/ObjCRuntimeGuide/Introduction/Introduction.html">官方文档</a></li>
<li>Objective-C语言将决定尽可能的从编译和连接时推迟到运行时，只要有可能Objective-C总是使用动态的方式来解决问题。这意味着Objective-C语言不仅需要一个编译器，同时也需要一个运行时系统来执行编译好的代码。这儿的运行时系统扮演的角色类似于Objective-C语言的操作系统，Objective-C基于该系统来工作。</li>
</ul>




  </p>
  <span class="meta">
    written 








  


<time datetime="2014-07-24T01:16:29+08:00" data-updated="true" itemprop="datePublished"></time>
    


  </span>

  
    <a class="full-article-link pull-right" rel="full-article" href="/blog/2014/07/24/objective-c-runtime-%5B%3F%5D/">阅读全文</a>
  
</article>

        </div>
      </div>
      
      
      <div class="row">
        <div class="col-md-offset-3 col-md-6">
          <article>
  <h2><a href="/blog/2014/07/02/uidynamicjian-dan-shi-yong/">UIDynamic简单使用</a></h2>
  
  <p>
    <h2>UIDynamic(一)</h2>




<h4>前言</h4>




<ul>
<li>最近工作之余，看了一下UIDynamic，UIDynamic是13年WWDC出得技术。其实本人一直热衷于比较有趣的动画，特别是带物理力学的动画，感觉物理力学就是动画的灵魂，一直想找几个小伙伴把物理与动画结合起来，做一下类似于物理引擎的迷你版玩玩，但是由于可支配时间不多，以至于这个夙愿未能完成，但发现UIDynamic这套UIKit自带的物理引擎也挺好玩的，所以先玩几天把，好了，废话不多说，直入正题。</li>
</ul>




<h4>基础</h4>




<ul>
<li>概念

<ul>
<li>UIDynamicItem:一个控件想要执行UIDynamicAnimator的动画就必须要继承这个协议。</li>
<li>UIDynamicAnimator:Animator为动态控件提供物理相关的力学和动画，也为这些动画提供了上下文，通过添加Behavier实例来实现想要的动画效果，在以下介绍到的物理力学里面一切动画的源头都是他，也可以说，UIKit的动力学最外层的包装就是它。</li>
<li>ReferenceView:在初始化UIDynamicAnimator的时候有一个叫做referenceView的属性，他是你的参考视图，你的子控件以及子控件的Beahavier就是参考这个视图的坐标的。</li>
<li>UIDynamicBehavior:它可以看做是把一种物理行为封装起来的一个类，一个Behavior实例可以赋予多个动态控件的一个物理行为。</li>
</ul>
</li>
</ul>




  </p>
  <span class="meta">
    written 








  


<time datetime="2014-07-02T22:46:29+08:00" data-updated="true" itemprop="datePublished"></time>
    


  </span>

  
    <a class="full-article-link pull-right" rel="full-article" href="/blog/2014/07/02/uidynamicjian-dan-shi-yong/">阅读全文</a>
  
</article>

        </div>
      </div>
      
      
      <div class="row">
        <div class="col-md-offset-3 col-md-6">
          <article>
  <h2><a href="/blog/2014/06/01/duo-dui-xiang-nei-cun-guan-li/">多对象内存管理</a></h2>
  
  <p>
    <h3>多对象内存管理(非ARC)</h3>




<ul>
<li>在非ARC中，多个对象内存管理要注意一些问题，例如循环利用，还有就是自己手写Set方法的时候要注意一些问题</li>
<li>指针释放 (set方法)</li>
</ul>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='objc'><span class='line'>  <span class="n">Person</span> <span class="o">*</span><span class="n">per</span> <span class="o">=</span> <span class="p">[[</span><span class="n">Person</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'>    <span class="n">Room</span> <span class="o">*</span><span class="n">r1</span> <span class="o">=</span> <span class="p">[[</span><span class="n">Room</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>
</span><span class='line'>    <span class="n">per</span><span class="p">.</span><span class="n">room</span> <span class="o">=</span> <span class="n">r1</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">[</span><span class="n">r1</span> <span class="k">release</span><span class="p">];</span>
</span><span class='line'>    <span class="p">[</span><span class="n">per</span> <span class="k">release</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>




<ul>
<li>由于执行完per.room = r1之后有两个指针指向同一份内存，[r1 release]后,r1所指向的内存空间被回收掉了，我们如果再像调用per.room就会报<code>message sent to deallocated instance</code>错误，所以我们要在Person里面做一些操作</li>
</ul>




  </p>
  <span class="meta">
    written 








  


<time datetime="2014-06-01T22:39:03+08:00" data-updated="true" itemprop="datePublished"></time>
    


  </span>

  
    <a class="full-article-link pull-right" rel="full-article" href="/blog/2014/06/01/duo-dui-xiang-nei-cun-guan-li/">阅读全文</a>
  
</article>

        </div>
      </div>
      
      
      <div class="row">
        <div class="col-md-offset-3 col-md-6">
          <article>
  <h2><a href="/blog/2014/05/31/nei-cun-guan-li-she-xi/">内存管理简单回顾</a></h2>
  
  <p>
    <h3>前言</h3>




<ul>
<li>程序员也要有自己的成长方式，每行都要有历练，程序员也不例外，时刻保持着接受历练的准备</li>
</ul>




<h3>内存管理简单回顾</h3>




<ul>
<li>增加一个app的内存占用

<ul>
<li>创建一个OC对象</li>
<li>定义一个变量</li>
<li>调用一个函数或者方法</li>
</ul>
</li>
<li>当app所占用的内存较多时，系统发出内存警告，这时回收一些不需要再使用的内存空间</li>
<li>所谓内存管理，就是对内存进行管理，涉及的操作有

<ul>
<li>分配内存：比如创建一个对象，会增加内存占用</li>
<li>清除内存：比如销毁一个对象，能减少内存占用</li>
</ul>
</li>
<li>内存管理的管理范围

<ul>
<li>任何继承NSObject的对象</li>
<li>对其他非对象类型无效(int char float double struct enum)</li>
</ul>
</li>
</ul>




  </p>
  <span class="meta">
    written 








  


<time datetime="2014-05-31T22:34:18+08:00" data-updated="true" itemprop="datePublished"></time>
    


  </span>

  
    <a class="full-article-link pull-right" rel="full-article" href="/blog/2014/05/31/nei-cun-guan-li-she-xi/">阅读全文</a>
  
</article>

        </div>
      </div>
      
      
      <div class="row">
        <div class="col-md-offset-3 col-md-6">
          <article>
  <h2><a href="/blog/2014/02/26/uinavigationri-chang-bug/">UINavigation日常Bug</a></h2>
  
  <p>
    <h3>UINavigation日常Bug</h3>




<ul>
<li>今天整理公司项目的时候,发现一个Bug，挺有意思的，就是在你不断调用Navigation<code>- (void)pushViewController:(UIViewController *)viewController animated:(BOOL)animated;</code>方法的时候，发现在不断点击一个按钮来调用这个方法，在点击返回调用<code>- (UIViewController *)popViewControllerAnimated:(BOOL)animated;</code>这个方法，这是在多次点击返回不但没有返回，还多次向Navigition里面添加控制器。</li>
</ul>




<p><img src="/images/blog/UINavigationBug/bug_0.gif" alt="" /></p>




  </p>
  <span class="meta">
    written 








  


<time datetime="2014-02-26T19:59:31+08:00" data-updated="true" itemprop="datePublished"></time>
    


  </span>

  
    <a class="full-article-link pull-right" rel="full-article" href="/blog/2014/02/26/uinavigationri-chang-bug/">阅读全文</a>
  
</article>

        </div>
      </div>
      
      
      <div class="row">
        <div class="col-md-offset-3 col-md-6">
          <article>
  <h2><a href="/blog/2013/08/22/qqyin-le-zong-jie/">QQ音乐总结</a></h2>
  
  <p>
    <h4>前言</h4>




<ul>
<li>对于项目，有些细节以及小技巧是网上很难表达的，也很难找到，这需要经验的积累，如果有某些有经验的开发人员教你一些小技巧，经验心得，一定要总结，这样就可以少走很多弯路.</li>
<li>多媒体有别于我们一般的接触的项目，一切都值得记录。</li>
</ul>




  </p>
  <span class="meta">
    written 








  


<time datetime="2013-08-22T14:40:29+08:00" data-updated="true" itemprop="datePublished"></time>
    


  </span>

  
    <a class="full-article-link pull-right" rel="full-article" href="/blog/2013/08/22/qqyin-le-zong-jie/">阅读全文</a>
  
</article>

        </div>
      </div>
      
    </div>
  </div>
</div>
</div>
			</div>
			<footer id="footer" class="inner">Copyright &copy; 2015

    etund


<!-- Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a> --></footer>
		</div>
	</div>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->






</body>
</html>
